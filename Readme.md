# Bilibili 下载器

这是一个基于 Python 的、功能强大且高度可配置的命令行工具，旨在帮助用户方便地从 Bilibili (B站) 下载视频或提取音频。

脚本通过一个简单的 `config.ini` 文件进行设置，可以自动解析视频链接，选择最高质量的音视频流，进行格式转换，并支持批量处理和重复下载检测。

## ✨ 功能特性-2025-07-10更新

  * **高度可配置**: 通过 `config.ini` 文件，轻松切换下载模式（视频/音频），并自定义文件名格式、MP3转换等选项。
  * **视频/音频下载**: 不仅可以提取音频，还可以下载最高画质的视频（DASH流），并自动合并为 MP4 文件。
  * **批量下载**: 支持在 `get.txt` 文件中放入多个视频链接，实现一键批量处理。
  * **重复下载检测**: 通过日志文件记录已完成的下载，有效避免重复处理同一个视频。
  * **智能命名**: 自动获取视频标题和发布日期，可配置是否将日期添加到文件名中（如 `[视频标题]_[发布日期].mp4`），便于管理。
  * **格式转换**: 下载音频时，可选择自动调用 `ffmpeg` 将B站原生的M4A音频格式转换为兼容性更强的MP3格式。
  * **自动选择最高质量**: 脚本会自动分析并选择非会员、非登录状态下可获取的最高码率的视频流和音频流。
  * **进度条显示**: 为文件下载和格式转换过程提供了直观的命令行进度条。
  * **环境依赖检测**: 启动时会自动检查系统中是否已正确安装并配置 `ffmpeg`。
  * **自动创建文件**: 首次运行时，会自动创建 `config.ini` 和 `get.txt`，简化初始设置。

## 🚀 环境要求

在运行此脚本之前，请确保您的电脑上已安装并配置好以下软件：

1.  **Python 3**: 脚本基于 Python 3.11.0 编写。

      * [Python 官方网站](https://www.python.org/)

2.  **FFmpeg**: 这是进行音视频合并与格式转换的核心工具。

      * 您必须先安装 FFmpeg，并**将其路径添加到系统的环境变量中**，否则脚本将无法运行。
      * [FFmpeg 官方网站](https://ffmpeg.org/download.html)
      * 您可以在终端或命令提示符中运行 `ffmpeg -version` 来检查是否配置成功。

## 🛠️ 安装与设置

1.  **下载脚本**

      * 将 `main.py` 脚本文件下载到您电脑的任意位置。

2.  **安装 Python 依赖库**

      * 本脚本需要 `requests` 库来发送网络请求。请在终端中运行以下命令进行安装：
        ```sh
        pip install requests
        ```

3.  **确认 FFmpeg 环境**

      * 再次确认您已正确安装 FFmpeg 并配置了环境变量。这是脚本正常工作的关键前提。

## 📝 使用方法

1.  **首次运行并配置**

      * 直接运行脚本 (`python main.py`)，它会自动在同目录下生成 `config.ini` 和 `get.txt` 文件。
      * 打开 `config.ini` 文件，根据您的需求修改配置。例如，将 `download_choice` 改为 `1` 以下载视频。
        ```ini
        [Settings]
        # 下载选项: 1 = 仅视频, 2 = 仅音频
        download_choice = 1
        # 如果下载音频，是否自动转换为MP3格式 (true/false)
        convert_to_mp3 = true
        # 是否在文件名后添加日期 (true/false)
        add_date_watermark = true
        # 是否开启重复下载检测 (true/false)
        duplicate_detection = true
        ```

2.  **添加视频链接**

      * 打开自动生成的 `get.txt` 文件，将一个或多个您想下载的B站视频链接粘贴进去。**请确保每个链接占一行**。
      * 例如：
        ```txt
        https://www.bilibili.com/video/BV1y7411Q7Eq
        https://www.bilibili.com/video/BV1uL411j7L4
        ```

3.  **运行脚本**

      * 打开您的终端（或命令提示符），切换到脚本所在的目录，然后再次运行以下命令：
        ```sh
        python main.py
        ```
![使用示例-执行main.py](images/示例.png)
4.  **查找文件**

      * 脚本运行后，会在当前目录下自动创建一个名为 `download` 的文件夹。所有成功处理的 `.mp4`, `.mp3` 或 `.m4a` 文件都将保存在这里。

## 📁 文件结构

```
.
├── main.py             # 主脚本
├── config.ini          # 配置文件 (首次运行自动生成)
├── get.txt             # 视频链接输入文件 (首次运行自动生成)
├── download_log.txt    # 下载日志，用于去重 (自动生成)
└── download/           # 下载输出目录
    ├── 示例视频A_2025-07-10.mp4
    └── 示例音频B_2025-07-09.mp3
```

## ⚠️ 注意事项

  * 本脚本仅供个人学习和技术交流使用，请勿用于非法用途或商业目的。
  * B站的API可能会不定期更新，如果未来脚本失效，可能是因为API接口发生了变化。
  * 下载和转换的速度取决于您的网络状况和电脑性能。